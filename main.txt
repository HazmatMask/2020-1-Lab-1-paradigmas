#lang racket
(require "tda-commit.rkt")
(require "tda-commit-list.rkt")
(require "tda-zone.rkt")
(require "tda-command-list.rkt")
(require "tda-zone-list.rkt")
(require "pull.rkt")

;GIT

(define git (lambda (C)
              (if (equal? C "pull")
                  (lambda (Q) (pull Q))
                  (if (equal? C "add")
                      (lambda (F) (pull F))
                      (if (equal? C "commit")
                          (lambda (MSG) (commit MSG))
                          (if (equal? C "push")
                              (lambda (Q) (push Q))
                              null))))))

;PULL

(define pull (lambda (Q)
               (create_zone_list
                (add_command_to_list "pull" (get_command_list Q))
                (create_zone
                 "WORKSPACE"
                 (merge_lists_commits
                  (extract_unique_commits
                   (get_commit_list (get_remote_repository Q))
                   (get_commit_list (get_workspace Q))) (get_commit_list (get_workspace Q))))
                (get_index Q)
                (get_local_repository Q)
                (get_remote_repository Q))))

;ADD

(define add (lambda (L)
               (if (null? L)
                   (lambda (Q)
                     (Q))
                   (lambda (Q)
                     (create_zone_list
                      (add_command_to_list "add" (get_command_list Q))
                      (get_workspace Q)
                      (create_zone
                       "INDEX"
                      (merge_lists_commits                       
                       (delete_modified_commits (get_commit_list (get_index Q)) L)
                       (extract_modified_commits
                        L
                       (get_commit_list (get_index Q)))))                     
                      (get_local_repository Q)
                      (get_remote_repository Q))))))

;COMMIT

(define commit (lambda (MSG)
                 (lambda (Q)
                   (create_zone_list
                    (add_command_to_list "commit" (get_command_list Q))
                    (get_workspace Q)
                    (delete-zone-commit-list "INDEX")
                    (create_zone
                     "LOCAL REPOSITORY"
                     (add_message_to_commits_list MSG (get_commit_list (get_index Q))))
                    (get_remote_repository Q)))))

;PUSH

(define push (lambda (Q)
               (create_zone_list
                (add_command_to_list "push" (get_command_list Q))
                (get_workspace Q)
                (get_index Q)
                (get_local_repository Q)
                (create_zone
                 "REMOTE REPOSITORY"
                 (get_commit_list (get_local_repository Q))))))

;ZONAS->STRING

(define zonas->string (lambda (Q)
                        (string-append "\n###LISTA DE COMANDOS UTILIZADOS###\n\n"
                                       (list_of_commands->string (get_command_list Q) "") "\n"
                                       (zone->string (get_workspace Q))
                                       (zone->string (get_index Q))
                                       (zone->string (get_local_repository Q))
                                       (zone->string (get_remote_repository Q))
                                       )))